<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>YouTube Section Looper</title>
  <style>
    :root {
      --bg-color: #f7f7f7;
      --text-color: #222;
      --input-bg: white;
      --input-border: #ccc;
      --button-bg: #cc0000;
      --button-text: white;
    }

    .dark {
      --bg-color: #121212;
      --text-color: #f0f0f0;
      --input-bg: #1e1e1e;
      --input-border: #444;
      --button-bg: #bb0000;
      --button-text: #fff;
    }

    body {
      font-family: sans-serif;
      padding: 2rem;
      background: var(--bg-color);
      color: var(--text-color);
      transition: background 0.3s, color 0.3s;
    }

    h1 {
      margin-bottom: 1rem;
    }

    .input-group {
      margin-bottom: 1rem;
    }

    label {
      display: block;
      margin-bottom: 0.25rem;
    }

    input {
      padding: 0.5rem;
      width: 100%;
      max-width: 400px;
      font-size: 1rem;
      background: var(--input-bg);
      color: var(--text-color);
      border: 1px solid var(--input-border);
      border-radius: 4px;
    }

    button {
      padding: 0.6rem 1rem;
      font-size: 1rem;
      background-color: var(--button-bg);
      color: var(--button-text);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 1rem;
      margin-right: 1rem;
    }

    #player {
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <h1>YouTube Section Looper</h1>
  <div class="input-group">
    <label for="videoUrl">YouTube Video URL</label>
    <input type="text" id="videoUrl" placeholder="e.g. https://www.youtube.com/watch?v=dQw4w9WgXcQ" />
  </div>
  <div class="input-group">
    <label for="startTime">Start Time (mm:ss)</label>
    <input type="text" id="startTime" placeholder="e.g. 01:05" />
  </div>
  <div class="input-group">
    <label for="endTime">End Time (mm:ss)</label>
    <input type="text" id="endTime" placeholder="e.g. 01:20" />
  </div>
  <button onclick="loadVideo()">Loop Section</button>
  <button onclick="toggleDarkMode()">Toggle Dark Mode</button>

  <div id="player"></div>

  <script>
    let player;
    let loopStart = 0;
    let loopEnd = 0;
    let checkInterval = null;

    function getVideoId(url) {
      const regex = /(?:v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
      const match = url.match(regex);
      return match ? match[1] : null;
    }

    function mmssToSeconds(mmss) {
      const parts = mmss.split(':').map(Number);
      if (parts.length !== 2 || isNaN(parts[0]) || isNaN(parts[1])) return 0;
      return parts[0] * 60 + parts[1];
    }

    function loadVideo() {
      const url = document.getElementById('videoUrl').value;
      const startStr = document.getElementById('startTime').value;
      const endStr = document.getElementById('endTime').value;

      const videoId = getVideoId(url);
      if (!videoId) {
        alert('Invalid YouTube URL');
        return;
      }

      loopStart = mmssToSeconds(startStr);
      loopEnd = mmssToSeconds(endStr);

      if (loopEnd <= loopStart) {
        alert('End time must be after start time');
        return;
      }

      if (player) {
        player.loadVideoById({ videoId: videoId, startSeconds: loopStart });
      } else {
        player = new YT.Player('player', {
          width: '1024',
          height: '768',
          videoId: videoId,
          playerVars: {
            autoplay: 1,
            controls: 1,
            rel: 0,
            modestbranding: 1,
            start: loopStart
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }
    }

    function onPlayerReady(event) {
      event.target.seekTo(loopStart);
      event.target.playVideo();
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING) {
        if (checkInterval) clearInterval(checkInterval);
        checkInterval = setInterval(() => {
          const currentTime = player.getCurrentTime();
          if (currentTime >= loopEnd) {
            player.seekTo(loopStart);
          }
        }, 500);
      } else {
        if (checkInterval) {
          clearInterval(checkInterval);
          checkInterval = null;
        }
      }
    }

    // Theme toggle
    function toggleDarkMode() {
      document.body.classList.toggle('dark');
      const isDark = document.body.classList.contains('dark');
      localStorage.setItem('darkMode', isDark ? '1' : '0');
    }

    // Persist theme preference
    window.onload = () => {
      if (localStorage.getItem('darkMode') === '1') {
        document.body.classList.add('dark');
      }
    };

    // Load the YouTube IFrame API
    let tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);
  </script>
</body>
</html>